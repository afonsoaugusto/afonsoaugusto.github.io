<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Anotações para a certificação GCP PCA: Gerenciamento de Clusters Multi-tenant no GKE | Afonso Rodrigues - DevOps & SRE Blog</title><meta name=keywords content><meta name=description content="Este artigo apresenta conceitos e práticas essenciais para o gerenciamento de clusters GKE multi-tenant, baseado no lab Managing a GKE Multi-tenant Cluster with Namespaces. Abordamos IAM roles, RBAC, Resource Quotas e GKE Usage Metering, fundamentais para a certificação GCP Professional Cloud Architect (PCA).
Índice

GKE IAM Roles
RBAC no Kubernetes
Resource Quotas
GKE Usage Metering
Exemplos Práticos

GKE IAM Roles
Os IAM roles do GKE controlam o acesso ao nível do GCP, permitindo ou negando acesso aos clusters e seus recursos. Abaixo estão os principais roles disponíveis:"><meta name=author content="Afonso Rodrigues"><link rel=canonical href=https://afonsorodrigues.com/posts/anotacoes-certificacao-gcp/><meta name=google-site-verification content="G-8TFSN8203P"><link crossorigin=anonymous href=/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://afonsorodrigues.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://afonsorodrigues.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://afonsorodrigues.com/favicon-32x32.png><link rel=apple-touch-icon href=https://afonsorodrigues.com/apple-touch-icon.png><link rel=mask-icon href=https://afonsorodrigues.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://afonsorodrigues.com/posts/anotacoes-certificacao-gcp/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://afonsorodrigues.com/posts/anotacoes-certificacao-gcp/"><meta property="og:site_name" content="Afonso Rodrigues - DevOps & SRE Blog"><meta property="og:title" content="Anotações para a certificação GCP PCA: Gerenciamento de Clusters Multi-tenant no GKE"><meta property="og:description" content="Este artigo apresenta conceitos e práticas essenciais para o gerenciamento de clusters GKE multi-tenant, baseado no lab Managing a GKE Multi-tenant Cluster with Namespaces. Abordamos IAM roles, RBAC, Resource Quotas e GKE Usage Metering, fundamentais para a certificação GCP Professional Cloud Architect (PCA).
Índice GKE IAM Roles RBAC no Kubernetes Resource Quotas GKE Usage Metering Exemplos Práticos GKE IAM Roles Os IAM roles do GKE controlam o acesso ao nível do GCP, permitindo ou negando acesso aos clusters e seus recursos. Abaixo estão os principais roles disponíveis:"><meta property="og:locale" content="pt-br"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-05T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-05T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Anotações para a certificação GCP PCA: Gerenciamento de Clusters Multi-tenant no GKE"><meta name=twitter:description content="Este artigo apresenta conceitos e práticas essenciais para o gerenciamento de clusters GKE multi-tenant, baseado no lab Managing a GKE Multi-tenant Cluster with Namespaces. Abordamos IAM roles, RBAC, Resource Quotas e GKE Usage Metering, fundamentais para a certificação GCP Professional Cloud Architect (PCA).
Índice

GKE IAM Roles
RBAC no Kubernetes
Resource Quotas
GKE Usage Metering
Exemplos Práticos

GKE IAM Roles
Os IAM roles do GKE controlam o acesso ao nível do GCP, permitindo ou negando acesso aos clusters e seus recursos. Abaixo estão os principais roles disponíveis:"><meta name=twitter:site content="@Afonsoavr"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://afonsorodrigues.com/posts/"},{"@type":"ListItem","position":2,"name":"Anotações para a certificação GCP PCA: Gerenciamento de Clusters Multi-tenant no GKE","item":"https://afonsorodrigues.com/posts/anotacoes-certificacao-gcp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Anotações para a certificação GCP PCA: Gerenciamento de Clusters Multi-tenant no GKE","name":"Anotações para a certificação GCP PCA: Gerenciamento de Clusters Multi-tenant no GKE","description":"Este artigo apresenta conceitos e práticas essenciais para o gerenciamento de clusters GKE multi-tenant, baseado no lab Managing a GKE Multi-tenant Cluster with Namespaces. Abordamos IAM roles, RBAC, Resource Quotas e GKE Usage Metering, fundamentais para a certificação GCP Professional Cloud Architect (PCA).\nÍndice GKE IAM Roles RBAC no Kubernetes Resource Quotas GKE Usage Metering Exemplos Práticos GKE IAM Roles Os IAM roles do GKE controlam o acesso ao nível do GCP, permitindo ou negando acesso aos clusters e seus recursos. Abaixo estão os principais roles disponíveis:\n","keywords":[],"articleBody":"Este artigo apresenta conceitos e práticas essenciais para o gerenciamento de clusters GKE multi-tenant, baseado no lab Managing a GKE Multi-tenant Cluster with Namespaces. Abordamos IAM roles, RBAC, Resource Quotas e GKE Usage Metering, fundamentais para a certificação GCP Professional Cloud Architect (PCA).\nÍndice GKE IAM Roles RBAC no Kubernetes Resource Quotas GKE Usage Metering Exemplos Práticos GKE IAM Roles Os IAM roles do GKE controlam o acesso ao nível do GCP, permitindo ou negando acesso aos clusters e seus recursos. Abaixo estão os principais roles disponíveis:\nRole Descrição Kubernetes Engine Admin (roles/container.admin) Fornece acesso completo ao gerenciamento de clusters e seus objetos da API do Kubernetes. Um usuário com este role pode criar, editar e deletar qualquer recurso em qualquer cluster e namespaces subsequentes. Kubernetes Engine Developer (roles/container.developer) Fornece acesso aos objetos da API do Kubernetes dentro dos clusters. Um usuário com este role pode criar, editar e deletar recursos em qualquer cluster e namespaces subsequentes. Kubernetes Engine Cluster Admin (roles/container.clusterAdmin) Fornece acesso ao gerenciamento de clusters. Um usuário com este role não terá acesso para criar ou editar recursos dentro de qualquer cluster ou namespaces diretamente, mas poderá criar, modificar e deletar qualquer cluster. Kubernetes Engine Viewer (roles/container.viewer) Acesso somente leitura aos recursos do GKE. Um usuário com este role terá acesso somente leitura a namespaces e seus recursos. Kubernetes Engine Cluster Viewer (roles/container.clusterViewer) Acesso de get e list aos clusters GKE. Este é o role mínimo necessário para qualquer pessoa que precise acessar recursos dentro dos namespaces de um cluster. Associando IAM Roles a Service Accounts Para associar um role IAM a uma service account no GCP (a nível de projeto):\n1 2 3 gcloud projects add-iam-policy-binding ${GOOGLE_CLOUD_PROJECT} \\ --member=serviceAccount:team-a-dev@${GOOGLE_CLOUD_PROJECT}.iam.gserviceaccount.com \\ --role=roles/container.clusterViewer Nota: O role container.clusterViewer é necessário para que a service account possa acessar o cluster. Sem ele, mesmo com RBAC configurado, a service account não conseguirá se autenticar no cluster.\nRBAC no Kubernetes O RBAC (Role-Based Access Control) no Kubernetes controla o acesso aos recursos dentro do cluster. É importante entender a diferença:\nIAM Roles: Controlam acesso ao nível do GCP (quem pode acessar o cluster) RBAC: Controla o que pode ser feito dentro do cluster (quais operações são permitidas) Criando Roles Via kubectl 1 2 3 4 5 kubectl create role pod-reader \\ --resource=pods \\ --verb=watch \\ --verb=get \\ --verb=list Via YAML 1 2 3 4 5 6 7 8 9 10 11 12 apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: namespace: team-a name: developer rules: - apiGroups: [\"\"] resources: [\"pods\", \"services\", \"serviceaccounts\"] verbs: [\"update\", \"create\", \"delete\", \"get\", \"watch\", \"list\"] - apiGroups: [\"apps\"] resources: [\"deployments\"] verbs: [\"update\", \"create\", \"delete\", \"get\", \"watch\", \"list\"] Criando RoleBindings Um RoleBinding associa uma Role a um usuário, grupo ou service account:\n1 2 3 4 kubectl create rolebinding team-a-developers \\ --role=developer \\ --user=team-a-dev@${GOOGLE_CLOUD_PROJECT}.iam.gserviceaccount.com \\ -n team-a Ou usando dry-run para revisar antes de aplicar:\n1 2 3 4 5 kubectl create rolebinding team-a-developers \\ --role=developer \\ --user=team-a-dev@${GOOGLE_CLOUD_PROJECT}.iam.gserviceaccount.com \\ -n team-a \\ --dry-run=client -o yaml | kubectl apply -f- Autenticação com Service Account Para usar uma service account para autenticação:\nCriar a chave da service account: 1 2 gcloud iam service-accounts keys create /tmp/key.json \\ --iam-account=team-a-dev@${GOOGLE_CLOUD_PROJECT}.iam.gserviceaccount.com Ativar a service account: 1 gcloud auth activate-service-account --key-file=/tmp/key.json Obter credenciais do cluster: 1 2 3 4 export ZONE=us-central1-f gcloud container clusters get-credentials multi-tenant-cluster \\ --zone ${ZONE} \\ --project ${GOOGLE_CLOUD_PROJECT} Resource Quotas Resource Quotas permitem limitar o uso de recursos em um namespace, controlando:\nQuantidade de recursos computacionais (CPU, memória) Quantidade de objetos (pods, services, etc.) Tipos específicos de recursos (LoadBalancers, PersistentVolumes, etc.) Exemplo: Quota Simples 1 2 3 kubectl create quota test-quota \\ --hard=count/pods=2,count/services.loadbalancers=1 \\ --namespace=team-a Exemplo de uso:\n1 2 3 4 5 6 7 8 9 10 11 12 13 # Criar pod 1 - sucesso kubectl run app-server-1 --image=quay.io/centos/centos:9 \\ --namespace=team-a -- sleep infinity # Criar pod 2 - sucesso kubectl run app-server-2 --image=quay.io/centos/centos:9 \\ --namespace=team-a -- sleep infinity # Criar pod 3 - falha (quota excedida) kubectl run app-server-3 --image=quay.io/centos/centos:9 \\ --namespace=team-a -- sleep infinity # Error: pods \"app-server-3\" is forbidden: exceeded quota: test-quota, # requested: count/pods=1, used: count/pods=2, limited: count/pods=2 Verificar quota:\n1 kubectl describe quota test-quota --namespace=team-a Saída esperada:\nName: test-quota Namespace: team-a Resource Used Hard -------- ---- ---- count/pods 2 2 count/services.loadbalancers 0 1 Exemplo: Quota de CPU e Memória 1 2 3 4 5 6 7 8 9 10 11 apiVersion: v1 kind: ResourceQuota metadata: name: cpu-mem-quota namespace: team-a spec: hard: limits.cpu: \"4\" limits.memory: \"12Gi\" requests.cpu: \"2\" requests.memory: \"8Gi\" Esta quota limita:\nRequests: CPU mínimo total de 2 cores, memória mínima de 8Gi Limits: CPU máximo total de 4 cores, memória máxima de 12Gi Importante: Todos os pods no namespace devem ter requests e limits definidos quando uma ResourceQuota com limites de CPU/memória está ativa.\nGKE Usage Metering O GKE Usage Metering permite rastrear o uso de recursos (CPU e memória) por namespace, pod e labels, exportando os dados para o BigQuery. Isso é essencial para:\nChargeback: Alocar custos por time/namespace Otimização: Identificar namespaces com uso excessivo Planejamento: Prever necessidades futuras de recursos Habilitando Usage Metering 1 2 3 4 export ZONE=us-central1-f gcloud container clusters update multi-tenant-cluster \\ --zone ${ZONE} \\ --resource-usage-bigquery-dataset cluster_dataset Pré-requisitos:\nO dataset do BigQuery deve existir antes de habilitar o usage metering A service account do GKE precisa de permissões no BigQuery Criando a Tabela de Cost Breakdown O GKE Usage Metering cria duas tabelas no BigQuery:\ngke_cluster_resource_usage: Baseado em requests (recursos solicitados) gke_cluster_resource_consumption: Baseado em consumo real Para criar uma tabela de cost breakdown que combine dados de billing com usage metering, siga a documentação oficial.\nConfiguração de variáveis:\n1 2 3 4 5 6 export GCP_BILLING_EXPORT_TABLE_FULL_PATH=${GOOGLE_CLOUD_PROJECT}.billing_dataset.gcp_billing_export_v1_xxxx export USAGE_METERING_DATASET_ID=cluster_dataset export COST_BREAKDOWN_TABLE_ID=usage_metering_cost_breakdown export USAGE_METERING_QUERY_TEMPLATE=~/gke-qwiklab/usage_metering_query_template.sql export USAGE_METERING_QUERY=cost_breakdown_query.sql export USAGE_METERING_START_DATE=2020-10-26 Substituir variáveis no template:\n1 2 3 4 5 6 7 sed \\ -e \"s/\\${fullGCPBillingExportTableID}/$GCP_BILLING_EXPORT_TABLE_FULL_PATH/\" \\ -e \"s/\\${projectID}/$GOOGLE_CLOUD_PROJECT/\" \\ -e \"s/\\${datasetID}/$USAGE_METERING_DATASET_ID/\" \\ -e \"s/\\${startDate}/$USAGE_METERING_START_DATE/\" \\ \"$USAGE_METERING_QUERY_TEMPLATE\" \\ \u003e \"$USAGE_METERING_QUERY\" Criar scheduled query no BigQuery:\n1 2 3 4 5 6 7 8 bq query \\ --project_id=$GOOGLE_CLOUD_PROJECT \\ --use_legacy_sql=false \\ --destination_table=$USAGE_METERING_DATASET_ID.$COST_BREAKDOWN_TABLE_ID \\ --schedule='every 24 hours' \\ --display_name=\"GKE Usage Metering Cost Breakdown Scheduled Query\" \\ --replace=true \\ \"$(cat $USAGE_METERING_QUERY)\" Exemplos Práticos Exemplo 1: Pod com Resource Requests e Limits 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 apiVersion: v1 kind: Pod metadata: name: cpu-mem-demo spec: containers: - name: cpu-mem-demo-ctr image: nginx resources: requests: cpu: \"100m\" memory: \"128Mi\" limits: cpu: \"400m\" memory: \"512Mi\" Explicação:\nRequests: Garantem que o pod receberá pelo menos 100m de CPU e 128Mi de memória Limits: Impedem que o pod use mais que 400m de CPU e 512Mi de memória Exemplo 2: ResourceQuota Completa 1 2 3 4 5 6 7 8 9 10 11 apiVersion: v1 kind: ResourceQuota metadata: name: cpu-mem-quota namespace: team-a spec: hard: limits.cpu: \"4\" limits.memory: \"12Gi\" requests.cpu: \"2\" requests.memory: \"8Gi\" Exemplo 3: Role de Desenvolvedor 1 2 3 4 5 6 7 8 9 10 11 12 apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: namespace: team-a name: developer rules: - apiGroups: [\"\"] resources: [\"pods\", \"services\", \"serviceaccounts\"] verbs: [\"update\", \"create\", \"delete\", \"get\", \"watch\", \"list\"] - apiGroups: [\"apps\"] resources: [\"deployments\"] verbs: [\"update\", \"create\", \"delete\", \"get\", \"watch\", \"list\"] Exemplo 4: Quota por Contagem 1 2 3 4 5 6 7 8 9 apiVersion: v1 kind: ResourceQuota metadata: name: test-quota namespace: team-a spec: hard: count/pods: \"2\" count/services.loadbalancers: \"1\" Best Practices Princípio do Menor Privilégio: Sempre conceda apenas as permissões necessárias Separação de Responsabilidades: Use namespaces para isolar times/projetos Resource Quotas: Defina quotas desde o início para evitar uso excessivo Monitoramento: Habilite Usage Metering para rastrear custos e uso IAM + RBAC: Combine IAM roles (nível GCP) com RBAC (nível Kubernetes) para segurança em camadas Service Accounts: Use service accounts específicas para cada time/aplicação Documentação: Documente todas as permissões e quotas configuradas Conclusão O gerenciamento eficiente de clusters GKE multi-tenant requer uma compreensão sólida de:\nIAM Roles para controle de acesso ao nível do GCP RBAC para controle de acesso dentro do Kubernetes Resource Quotas para limitar uso de recursos Usage Metering para rastreamento de custos e otimização Esses conceitos são fundamentais não apenas para a certificação GCP PCA, mas também para a operação prática de clusters GKE em ambientes de produção.\nReferências Managing a GKE Multi-tenant Cluster with Namespaces GKE Usage Metering Documentation GKE IAM Roles Kubernetes RBAC Authorization ","wordCount":"1370","inLanguage":"en","datePublished":"2025-11-05T00:00:00Z","dateModified":"2025-11-05T00:00:00Z","author":{"@type":"Person","name":"Afonso Rodrigues"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://afonsorodrigues.com/posts/anotacoes-certificacao-gcp/"},"publisher":{"@type":"Organization","name":"Afonso Rodrigues - DevOps \u0026 SRE Blog","logo":{"@type":"ImageObject","url":"https://afonsorodrigues.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://afonsorodrigues.com/ accesskey=h title="Afonso Rodrigues - DevOps & SRE Blog (Alt + H)">Afonso Rodrigues - DevOps & SRE Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://afonsorodrigues.com/ title=Home><span>Home</span></a></li><li><a href=https://afonsorodrigues.com/about title=Sobre><span>Sobre</span></a></li><li><a href=https://afonsorodrigues.com/utils title=Utils><span>Utils</span></a></li><li><a href=https://afonsorodrigues.com/pages title=Páginas><span>Páginas</span></a></li><li><a href=https://afonsorodrigues.com/archive title=Arquivo><span>Arquivo</span></a></li><li><a href=https://afonsorodrigues.com/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Anotações para a certificação GCP PCA: Gerenciamento de Clusters Multi-tenant no GKE</h1><div class=post-meta><span title='2025-11-05 00:00:00 +0000 UTC'>November 5, 2025</span>&nbsp;·&nbsp;<span>Afonso Rodrigues</span></div></header><div class=post-content><p>Este artigo apresenta conceitos e práticas essenciais para o gerenciamento de clusters GKE multi-tenant, baseado no lab <a href=https://www.skills.google/paths/125/course_templates/655/labs/598636>Managing a GKE Multi-tenant Cluster with Namespaces</a>. Abordamos IAM roles, RBAC, Resource Quotas e GKE Usage Metering, fundamentais para a certificação GCP Professional Cloud Architect (PCA).</p><h2 id=índice>Índice<a hidden class=anchor aria-hidden=true href=#índice>#</a></h2><ol><li><a href=#gke-iam-roles>GKE IAM Roles</a></li><li><a href=#rbac-no-kubernetes>RBAC no Kubernetes</a></li><li><a href=#resource-quotas>Resource Quotas</a></li><li><a href=#gke-usage-metering>GKE Usage Metering</a></li><li><a href=#exemplos-pr%C3%A1ticos>Exemplos Práticos</a></li></ol><h2 id=gke-iam-roles>GKE IAM Roles<a hidden class=anchor aria-hidden=true href=#gke-iam-roles>#</a></h2><p>Os IAM roles do GKE controlam o acesso ao nível do GCP, permitindo ou negando acesso aos clusters e seus recursos. Abaixo estão os principais roles disponíveis:</p><table><thead><tr><th>Role</th><th>Descrição</th></tr></thead><tbody><tr><td><strong>Kubernetes Engine Admin</strong> (<code>roles/container.admin</code>)</td><td>Fornece acesso completo ao gerenciamento de clusters e seus objetos da API do Kubernetes. Um usuário com este role pode criar, editar e deletar qualquer recurso em qualquer cluster e namespaces subsequentes.</td></tr><tr><td><strong>Kubernetes Engine Developer</strong> (<code>roles/container.developer</code>)</td><td>Fornece acesso aos objetos da API do Kubernetes dentro dos clusters. Um usuário com este role pode criar, editar e deletar recursos em qualquer cluster e namespaces subsequentes.</td></tr><tr><td><strong>Kubernetes Engine Cluster Admin</strong> (<code>roles/container.clusterAdmin</code>)</td><td>Fornece acesso ao gerenciamento de clusters. Um usuário com este role não terá acesso para criar ou editar recursos dentro de qualquer cluster ou namespaces diretamente, mas poderá criar, modificar e deletar qualquer cluster.</td></tr><tr><td><strong>Kubernetes Engine Viewer</strong> (<code>roles/container.viewer</code>)</td><td>Acesso somente leitura aos recursos do GKE. Um usuário com este role terá acesso somente leitura a namespaces e seus recursos.</td></tr><tr><td><strong>Kubernetes Engine Cluster Viewer</strong> (<code>roles/container.clusterViewer</code>)</td><td>Acesso de get e list aos clusters GKE. Este é o role mínimo necessário para qualquer pessoa que precise acessar recursos dentro dos namespaces de um cluster.</td></tr></tbody></table><h3 id=associando-iam-roles-a-service-accounts>Associando IAM Roles a Service Accounts<a hidden class=anchor aria-hidden=true href=#associando-iam-roles-a-service-accounts>#</a></h3><p>Para associar um role IAM a uma service account no GCP (a nível de projeto):</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud projects add-iam-policy-binding <span style=color:#0a3069>${</span><span style=color:#953800>GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>}</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --member<span style=color:#0550ae>=</span>serviceAccount:team-a-dev@<span style=color:#0a3069>${</span><span style=color:#953800>GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>}</span>.iam.gserviceaccount.com <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --role<span style=color:#0550ae>=</span>roles/container.clusterViewer
</span></span></code></pre></td></tr></table></div></div><p><strong>Nota</strong>: O role <code>container.clusterViewer</code> é necessário para que a service account possa acessar o cluster. Sem ele, mesmo com RBAC configurado, a service account não conseguirá se autenticar no cluster.</p><h2 id=rbac-no-kubernetes>RBAC no Kubernetes<a hidden class=anchor aria-hidden=true href=#rbac-no-kubernetes>#</a></h2><p>O RBAC (Role-Based Access Control) no Kubernetes controla o acesso aos recursos dentro do cluster. É importante entender a diferença:</p><ul><li><strong>IAM Roles</strong>: Controlam acesso ao nível do GCP (quem pode acessar o cluster)</li><li><strong>RBAC</strong>: Controla o que pode ser feito dentro do cluster (quais operações são permitidas)</li></ul><h3 id=criando-roles>Criando Roles<a hidden class=anchor aria-hidden=true href=#criando-roles>#</a></h3><h4 id=via-kubectl>Via kubectl<a hidden class=anchor aria-hidden=true href=#via-kubectl>#</a></h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create role pod-reader <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --resource<span style=color:#0550ae>=</span>pods <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --verb<span style=color:#0550ae>=</span>watch <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --verb<span style=color:#0550ae>=</span>get <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --verb<span style=color:#0550ae>=</span>list
</span></span></code></pre></td></tr></table></div></div><h4 id=via-yaml>Via YAML<a hidden class=anchor aria-hidden=true href=#via-yaml>#</a></h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#0550ae>apiVersion</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>rbac.authorization.k8s.io/v1<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>kind</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Role<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>metadata</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>namespace</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>team-a<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>developer<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>rules</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>- <span style=color:#0550ae>apiGroups</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>resources</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;pods&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;services&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;serviceaccounts&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>verbs</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;update&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;create&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;delete&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;get&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;watch&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;list&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>- <span style=color:#0550ae>apiGroups</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;apps&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>resources</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;deployments&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>verbs</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;update&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;create&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;delete&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;get&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;watch&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;list&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=criando-rolebindings>Criando RoleBindings<a hidden class=anchor aria-hidden=true href=#criando-rolebindings>#</a></h3><p>Um RoleBinding associa uma Role a um usuário, grupo ou service account:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create rolebinding team-a-developers <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --role<span style=color:#0550ae>=</span>developer <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --user<span style=color:#0550ae>=</span>team-a-dev@<span style=color:#0a3069>${</span><span style=color:#953800>GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>}</span>.iam.gserviceaccount.com <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  -n team-a
</span></span></code></pre></td></tr></table></div></div><p>Ou usando dry-run para revisar antes de aplicar:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create rolebinding team-a-developers <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --role<span style=color:#0550ae>=</span>developer <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --user<span style=color:#0550ae>=</span>team-a-dev@<span style=color:#0a3069>${</span><span style=color:#953800>GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>}</span>.iam.gserviceaccount.com <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  -n team-a <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --dry-run<span style=color:#0550ae>=</span>client -o yaml <span style=color:#1f2328>|</span> kubectl apply -f-
</span></span></code></pre></td></tr></table></div></div><h3 id=autenticação-com-service-account>Autenticação com Service Account<a hidden class=anchor aria-hidden=true href=#autenticação-com-service-account>#</a></h3><p>Para usar uma service account para autenticação:</p><ol><li><strong>Criar a chave da service account</strong>:</li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud iam service-accounts keys create /tmp/key.json <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --iam-account<span style=color:#0550ae>=</span>team-a-dev@<span style=color:#0a3069>${</span><span style=color:#953800>GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>}</span>.iam.gserviceaccount.com
</span></span></code></pre></td></tr></table></div></div><ol start=2><li><strong>Ativar a service account</strong>:</li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcloud auth activate-service-account --key-file<span style=color:#0550ae>=</span>/tmp/key.json
</span></span></code></pre></td></tr></table></div></div><ol start=3><li><strong>Obter credenciais do cluster</strong>:</li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>ZONE</span><span style=color:#0550ae>=</span>us-central1-f
</span></span><span style=display:flex><span>gcloud container clusters get-credentials multi-tenant-cluster <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --zone <span style=color:#0a3069>${</span><span style=color:#953800>ZONE</span><span style=color:#0a3069>}</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --project <span style=color:#0a3069>${</span><span style=color:#953800>GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=resource-quotas>Resource Quotas<a hidden class=anchor aria-hidden=true href=#resource-quotas>#</a></h2><p>Resource Quotas permitem limitar o uso de recursos em um namespace, controlando:</p><ul><li>Quantidade de recursos computacionais (CPU, memória)</li><li>Quantidade de objetos (pods, services, etc.)</li><li>Tipos específicos de recursos (LoadBalancers, PersistentVolumes, etc.)</li></ul><h3 id=exemplo-quota-simples>Exemplo: Quota Simples<a hidden class=anchor aria-hidden=true href=#exemplo-quota-simples>#</a></h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create quota test-quota <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --hard<span style=color:#0550ae>=</span>count/pods<span style=color:#0550ae>=</span>2,count/services.loadbalancers<span style=color:#0550ae>=</span><span style=color:#0550ae>1</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --namespace<span style=color:#0550ae>=</span>team-a
</span></span></code></pre></td></tr></table></div></div><p><strong>Exemplo de uso</strong>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#57606a># Criar pod 1 - sucesso</span>
</span></span><span style=display:flex><span>kubectl run app-server-1 --image<span style=color:#0550ae>=</span>quay.io/centos/centos:9 <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --namespace<span style=color:#0550ae>=</span>team-a -- sleep infinity
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># Criar pod 2 - sucesso</span>
</span></span><span style=display:flex><span>kubectl run app-server-2 --image<span style=color:#0550ae>=</span>quay.io/centos/centos:9 <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --namespace<span style=color:#0550ae>=</span>team-a -- sleep infinity
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># Criar pod 3 - falha (quota excedida)</span>
</span></span><span style=display:flex><span>kubectl run app-server-3 --image<span style=color:#0550ae>=</span>quay.io/centos/centos:9 <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --namespace<span style=color:#0550ae>=</span>team-a -- sleep infinity
</span></span><span style=display:flex><span><span style=color:#57606a># Error: pods &#34;app-server-3&#34; is forbidden: exceeded quota: test-quota, </span>
</span></span><span style=display:flex><span><span style=color:#57606a># requested: count/pods=1, used: count/pods=2, limited: count/pods=2</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Verificar quota</strong>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe quota test-quota --namespace<span style=color:#0550ae>=</span>team-a
</span></span></code></pre></td></tr></table></div></div><p>Saída esperada:</p><pre tabindex=0><code>Name:                         test-quota
Namespace:                    team-a
Resource                      Used  Hard
--------                      ----  ----
count/pods                    2     2
count/services.loadbalancers  0     1
</code></pre><h3 id=exemplo-quota-de-cpu-e-memória>Exemplo: Quota de CPU e Memória<a hidden class=anchor aria-hidden=true href=#exemplo-quota-de-cpu-e-memória>#</a></h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#0550ae>apiVersion</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>v1<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>kind</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>ResourceQuota<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>metadata</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>cpu-mem-quota<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>namespace</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>team-a<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>spec</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>hard</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>limits.cpu</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;4&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>limits.memory</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;12Gi&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>requests.cpu</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;2&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>requests.memory</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;8Gi&#34;</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p>Esta quota limita:</p><ul><li><strong>Requests</strong>: CPU mínimo total de 2 cores, memória mínima de 8Gi</li><li><strong>Limits</strong>: CPU máximo total de 4 cores, memória máxima de 12Gi</li></ul><p><strong>Importante</strong>: Todos os pods no namespace devem ter <code>requests</code> e <code>limits</code> definidos quando uma ResourceQuota com limites de CPU/memória está ativa.</p><h2 id=gke-usage-metering>GKE Usage Metering<a hidden class=anchor aria-hidden=true href=#gke-usage-metering>#</a></h2><p>O GKE Usage Metering permite rastrear o uso de recursos (CPU e memória) por namespace, pod e labels, exportando os dados para o BigQuery. Isso é essencial para:</p><ul><li><strong>Chargeback</strong>: Alocar custos por time/namespace</li><li><strong>Otimização</strong>: Identificar namespaces com uso excessivo</li><li><strong>Planejamento</strong>: Prever necessidades futuras de recursos</li></ul><h3 id=habilitando-usage-metering>Habilitando Usage Metering<a hidden class=anchor aria-hidden=true href=#habilitando-usage-metering>#</a></h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>ZONE</span><span style=color:#0550ae>=</span>us-central1-f
</span></span><span style=display:flex><span>gcloud container clusters update multi-tenant-cluster <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --zone <span style=color:#0a3069>${</span><span style=color:#953800>ZONE</span><span style=color:#0a3069>}</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --resource-usage-bigquery-dataset cluster_dataset
</span></span></code></pre></td></tr></table></div></div><p><strong>Pré-requisitos</strong>:</p><ul><li>O dataset do BigQuery deve existir antes de habilitar o usage metering</li><li>A service account do GKE precisa de permissões no BigQuery</li></ul><h3 id=criando-a-tabela-de-cost-breakdown>Criando a Tabela de Cost Breakdown<a hidden class=anchor aria-hidden=true href=#criando-a-tabela-de-cost-breakdown>#</a></h3><p>O GKE Usage Metering cria duas tabelas no BigQuery:</p><ul><li><code>gke_cluster_resource_usage</code>: Baseado em requests (recursos solicitados)</li><li><code>gke_cluster_resource_consumption</code>: Baseado em consumo real</li></ul><p>Para criar uma tabela de cost breakdown que combine dados de billing com usage metering, siga a <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-usage-metering?hl=pt-br#create_the_cost_breakdown_table">documentação oficial</a>.</p><p><strong>Configuração de variáveis</strong>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>GCP_BILLING_EXPORT_TABLE_FULL_PATH</span><span style=color:#0550ae>=</span><span style=color:#0a3069>${</span><span style=color:#953800>GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>}</span>.billing_dataset.gcp_billing_export_v1_xxxx
</span></span><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>USAGE_METERING_DATASET_ID</span><span style=color:#0550ae>=</span>cluster_dataset
</span></span><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>COST_BREAKDOWN_TABLE_ID</span><span style=color:#0550ae>=</span>usage_metering_cost_breakdown
</span></span><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>USAGE_METERING_QUERY_TEMPLATE</span><span style=color:#0550ae>=</span>~/gke-qwiklab/usage_metering_query_template.sql
</span></span><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>USAGE_METERING_QUERY</span><span style=color:#0550ae>=</span>cost_breakdown_query.sql
</span></span><span style=display:flex><span><span style=color:#6639ba>export</span> <span style=color:#953800>USAGE_METERING_START_DATE</span><span style=color:#0550ae>=</span>2020-10-26
</span></span></code></pre></td></tr></table></div></div><p><strong>Substituir variáveis no template</strong>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  -e <span style=color:#0a3069>&#34;s/\${fullGCPBillingExportTableID}/</span><span style=color:#953800>$GCP_BILLING_EXPORT_TABLE_FULL_PATH</span><span style=color:#0a3069>/&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  -e <span style=color:#0a3069>&#34;s/\${projectID}/</span><span style=color:#953800>$GOOGLE_CLOUD_PROJECT</span><span style=color:#0a3069>/&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  -e <span style=color:#0a3069>&#34;s/\${datasetID}/</span><span style=color:#953800>$USAGE_METERING_DATASET_ID</span><span style=color:#0a3069>/&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  -e <span style=color:#0a3069>&#34;s/\${startDate}/</span><span style=color:#953800>$USAGE_METERING_START_DATE</span><span style=color:#0a3069>/&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  <span style=color:#0a3069>&#34;</span><span style=color:#953800>$USAGE_METERING_QUERY_TEMPLATE</span><span style=color:#0a3069>&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  &gt; <span style=color:#0a3069>&#34;</span><span style=color:#953800>$USAGE_METERING_QUERY</span><span style=color:#0a3069>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Criar scheduled query no BigQuery</strong>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bq query <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --project_id<span style=color:#0550ae>=</span><span style=color:#953800>$GOOGLE_CLOUD_PROJECT</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --use_legacy_sql<span style=color:#0550ae>=</span><span style=color:#6639ba>false</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --destination_table<span style=color:#0550ae>=</span><span style=color:#953800>$USAGE_METERING_DATASET_ID</span>.<span style=color:#953800>$COST_BREAKDOWN_TABLE_ID</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --schedule<span style=color:#0550ae>=</span><span style=color:#0a3069>&#39;every 24 hours&#39;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --display_name<span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;GKE Usage Metering Cost Breakdown Scheduled Query&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  --replace<span style=color:#0550ae>=</span><span style=color:#6639ba>true</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>  <span style=color:#0a3069>&#34;</span><span style=color:#cf222e>$(</span>cat <span style=color:#953800>$USAGE_METERING_QUERY</span><span style=color:#cf222e>)</span><span style=color:#0a3069>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exemplos-práticos>Exemplos Práticos<a hidden class=anchor aria-hidden=true href=#exemplos-práticos>#</a></h2><h3 id=exemplo-1-pod-com-resource-requests-e-limits>Exemplo 1: Pod com Resource Requests e Limits<a hidden class=anchor aria-hidden=true href=#exemplo-1-pod-com-resource-requests-e-limits>#</a></h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#0550ae>apiVersion</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>v1<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>kind</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Pod<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>metadata</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>cpu-mem-demo<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>spec</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>containers</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span>- <span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>cpu-mem-demo-ctr<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>image</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>nginx<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>resources</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>      </span><span style=color:#0550ae>requests</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>cpu</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;100m&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>memory</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;128Mi&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>      </span><span style=color:#0550ae>limits</span><span style=color:#1f2328>:</span><span style=color:#fff> 
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>cpu</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;400m&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#0550ae>memory</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;512Mi&#34;</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>Explicação</strong>:</p><ul><li><strong>Requests</strong>: Garantem que o pod receberá pelo menos 100m de CPU e 128Mi de memória</li><li><strong>Limits</strong>: Impedem que o pod use mais que 400m de CPU e 512Mi de memória</li></ul><h3 id=exemplo-2-resourcequota-completa>Exemplo 2: ResourceQuota Completa<a hidden class=anchor aria-hidden=true href=#exemplo-2-resourcequota-completa>#</a></h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#0550ae>apiVersion</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>v1<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>kind</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>ResourceQuota<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>metadata</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>cpu-mem-quota<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>namespace</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>team-a<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>spec</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>hard</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>limits.cpu</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;4&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>limits.memory</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;12Gi&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>requests.cpu</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;2&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>requests.memory</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;8Gi&#34;</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=exemplo-3-role-de-desenvolvedor>Exemplo 3: Role de Desenvolvedor<a hidden class=anchor aria-hidden=true href=#exemplo-3-role-de-desenvolvedor>#</a></h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#0550ae>apiVersion</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>rbac.authorization.k8s.io/v1<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>kind</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Role<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>metadata</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>namespace</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>team-a<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>developer<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>rules</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>- <span style=color:#0550ae>apiGroups</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>resources</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;pods&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;services&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;serviceaccounts&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>verbs</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;update&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;create&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;delete&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;get&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;watch&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;list&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>- <span style=color:#0550ae>apiGroups</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;apps&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>resources</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;deployments&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>verbs</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;update&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;create&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;delete&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;get&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;watch&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;list&#34;</span><span style=color:#1f2328>]</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=exemplo-4-quota-por-contagem>Exemplo 4: Quota por Contagem<a hidden class=anchor aria-hidden=true href=#exemplo-4-quota-por-contagem>#</a></h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#0550ae>apiVersion</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>v1<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>kind</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>ResourceQuota<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>metadata</span><span style=color:#1f2328>:</span><span style=color:#fff> 
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>test-quota<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>namespace</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>team-a<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#0550ae>spec</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>  </span><span style=color:#0550ae>hard</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>count/pods</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;2&#34;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#0550ae>count/services.loadbalancers</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;1&#34;</span><span style=color:#fff>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=best-practices>Best Practices<a hidden class=anchor aria-hidden=true href=#best-practices>#</a></h2><ol><li><strong>Princípio do Menor Privilégio</strong>: Sempre conceda apenas as permissões necessárias</li><li><strong>Separação de Responsabilidades</strong>: Use namespaces para isolar times/projetos</li><li><strong>Resource Quotas</strong>: Defina quotas desde o início para evitar uso excessivo</li><li><strong>Monitoramento</strong>: Habilite Usage Metering para rastrear custos e uso</li><li><strong>IAM + RBAC</strong>: Combine IAM roles (nível GCP) com RBAC (nível Kubernetes) para segurança em camadas</li><li><strong>Service Accounts</strong>: Use service accounts específicas para cada time/aplicação</li><li><strong>Documentação</strong>: Documente todas as permissões e quotas configuradas</li></ol><h2 id=conclusão>Conclusão<a hidden class=anchor aria-hidden=true href=#conclusão>#</a></h2><p>O gerenciamento eficiente de clusters GKE multi-tenant requer uma compreensão sólida de:</p><ul><li><strong>IAM Roles</strong> para controle de acesso ao nível do GCP</li><li><strong>RBAC</strong> para controle de acesso dentro do Kubernetes</li><li><strong>Resource Quotas</strong> para limitar uso de recursos</li><li><strong>Usage Metering</strong> para rastreamento de custos e otimização</li></ul><p>Esses conceitos são fundamentais não apenas para a certificação GCP PCA, mas também para a operação prática de clusters GKE em ambientes de produção.</p><h2 id=referências>Referências<a hidden class=anchor aria-hidden=true href=#referências>#</a></h2><ul><li><a href=https://www.skills.google/paths/125/course_templates/655/labs/598636>Managing a GKE Multi-tenant Cluster with Namespaces</a></li><li><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-usage-metering>GKE Usage Metering Documentation</a></li><li><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/iam>GKE IAM Roles</a></li><li><a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/>Kubernetes RBAC Authorization</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://afonsorodrigues.com/>Afonso Rodrigues - DevOps & SRE Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>